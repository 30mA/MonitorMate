<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=800">
	<link rel="icon" href="./images/favicon16.png" type="image/png">
	<link rel="stylesheet" href="./css/monitormate.css" type="text/css">
	<link rel="stylesheet" href="./css/zebra.css" type="text/css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="./config/highcharts-themes.js"></script>
	<script type="text/javascript" src="./js/zebra_datepicker.js"></script>
	<script src="./config/config.php"></script>
	<script src="./js/monitormate.js"></script>
	<title>MonitorMate — Daily</title>
</head>
<body>
	<form action="javascript:void(0)" method="get">
		<div style="text-align: center;">
			Show graphs for: <input id="datepicker" class="datepicker" type="text" value="" onchange="alert('hi')">
			<button onclick="change_day(-1)">Prev</button><button onclick="change_day(0)">Today</button><button onclick="change_day(1)">Next</button>
			&mdash; Scope:
			<select id="scope" onchange="refresh_data();">
				<option value="0">Calendar Day</option>
				<option value="24">24 hours</option>
				<option value="36">36 hours</option>
				<option value="48">48 hours</option>
				<option value="72">72 hours</option>
			</select>
		</div>
	</form>
	<h2>State of Charge:</h2>
	<div id="flexnet_soc" class="bottom-wide-chart"></div>
	<h2>Input/Output:</h2>
	<div id="flexnet_shunts" class="bottom-wide-chart"></div>
	<h2>Battery Voltage:</h2>
	<div id="battery_volts" class="bottom-wide-chart"></div>
	<h2>PV Charge Power:</h2>
	<div id="charge_power" class="bottom-wide-chart"></div>
	<h2>PV Charge Current:</h2>
	<div id="charge_current" class="bottom-wide-chart"></div>
	<h2>PV Array Volts:</h2>
	<div id="array_volts" class="bottom-wide-chart"></div>
	<h2>PV Array Current:</h2>
	<div id="array_current" class="bottom-wide-chart"></div>
	<script>
		
		function refresh_data() {

			var date = $('#datepicker').val();
			var scope = $('#scope').val();
			var queryString = "?date=" + date + "&scope=" + scope;

			window.history.replaceState(null, "MonitorMate — Daily", queryString);
			
			get_dataStream(date, scope);
			
			draw_chart('flexnet_soc','flexnet_soc');
			draw_chart('flexnet_shunts','flexnet_shunts');
			draw_chart('battery_volts','battery_volts');
			draw_chart('charge_power','charge_power');
			draw_chart('charge_current','charge_current');
			draw_chart('array_volts','array_volts');
			draw_chart('array_current','array_current');
		}		


		function change_day(delta) {

			var delta = parseInt(delta);

			if (delta == 0) {
				dateString = get_formatted_date();
				$('#datepicker').val(dateString);
				refresh_data();
			} else {
				split_date = $('#datepicker').val().split(/[- :]/);
				new_date = new Date(parseInt(split_date[0]), parseInt(split_date[1] - 1), parseInt(split_date[2]));
				updated_date = new Date(new_date.getTime() + (delta * 86400000)); // one day in milliseconds
				
				if (updated_date < (new Date())) {	// make you're not sneaking into the future.
					dateString = get_formatted_date(updated_date);
					$('#datepicker').val(dateString);
					refresh_data();
				} else {
					alert("You can't predict the future...");
				}			
			}

		}


		function load_page() {
		
			var URLvars = get_URLvars();
			var date;
			var scope;
			
			if (URLvars.date) {
				// put the date from the querystring into the text field
				date = URLvars.date;
			} else {
				// put today into the text field
				date = get_formatted_date();
			}
			$('input.datepicker').val(date);
			
			if (URLvars.scope) {
				// put the scope from the querystring into the popup
				scope = URLvars.scope;
			} else {
				// put 0 (calendar day) into the popup
				scope = 0;
			}
			$('#scope').val(scope);
			
			// attach the date picker!
			$('input.datepicker').Zebra_DatePicker({
				direction: [false, '2013-01-01'],
				first_day_of_week: 0,
				show_clear_date: false,
				onSelect: function() {
					$('#scope').val('0');
					refresh_data();
				}
			});
						
			refresh_data();

			//setInterval("get_status()", 5000);		
		}

	</script>
</body>
</html>
