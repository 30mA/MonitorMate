<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=800">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="icon" href="./images/favicon16.png" type="image/png">
	<link rel="apple-touch-icon" href="./images/iosicon120.png" type="image/png">
	<link rel="stylesheet" href="./css/monitormate.css" type="text/css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/highcharts-more.js"></script>
	<script src="./config/config.php"></script>
	<script src="./js/monitormate.js"></script>
	<title>MonitorMate</title>
</head>
<body>
	<div id="navbar">
		<ol id="toc">
			<li><a href="current.html">Current Status</a></li>
			<li class="current"><a href="monitormate.html">Old Current</a></li>
			<li><a href="historical.html">Historical</a></li>
			<li><a href="details.html">Details</a></li>
		</ol>
		<h1 id="navtitle"></h1>
		<div id="button-cluster">
			Updated: <span id="update_time">?</span>
		</div>
	</div>
	<div id="left-col" class="status">
		<div id="soc_gauge" class="gauge-chart"></div>
		<div style="text-align: center; margin: 10px;">
			<select id="status_top_select" onchange="set_status('status_top',this.options[this.selectedIndex].value)"></select>
			<select id="status_bottom_select" onchange="set_status('status_bottom',this.options[this.selectedIndex].value)"></select>
		</div>
		<div id="status_top" class="status_content"></div>
		<div id="status_bottom" class="status_content"></div>
	</div>
	
	<div class="right-col">
		<select id="multichart1_select" onchange="set_chart('multichart1',this.options[this.selectedIndex].value)"></select>
		<div id="multichart1" class="multichart"></div>
	</div>
	<div class="right-col">	
		<select id="multichart2_select" onchange="set_chart('multichart2',this.options[this.selectedIndex].value)"></select>
		<div id="multichart2" class="multichart"></div>
	</div>
	<div class="right-col">		
		<select id="multichart3_select" onchange="set_chart('multichart3',this.options[this.selectedIndex].value)"></select>
		<div id="multichart3" class="multichart"></div>
	</div>
		
	<div id="days_chart" class="bottom-wide-chart"></div>

	<script>
		//
		// this is the way to get things started in jQuery. Seriously.
		//
		$(document).ready(function() {
		
			/*global chart_content, status_content */

			// set the system name in the navbar
			$('#navtitle').text(cfg_sysName);
			
			// get the datastream with no date (will use now) for 16 hours of data.
			get_dataStream(false, 12); 

			// get the cookie data and status
			get_cookies();
			get_current_status();

			// populate the select elements (popup menus)
			populate_status_select();
			populate_chart_select("multichart1_select");
			populate_chart_select("multichart2_select");
			populate_chart_select("multichart3_select");

			// Apply the common theme 
			Highcharts.setOptions(Highcharts.theme);

			// set and draw everything in the status column on the left
			draw_chart("soc_gauge", "fndc_soc_gauge");			
			set_status("status_top", status_content["status_top"]);
			set_status("status_bottom", status_content["status_bottom"]);

			// set and draw all the charts on the right
			set_chart("multichart1", chart_content["multichart1"]);
			set_chart("multichart2", chart_content["multichart2"]);
			set_chart("multichart3", chart_content["multichart3"]);

			// put in the day chart along the bottom
			chart_days();
					
			// update the status regularly
			setInterval("refresh_data()", 15*1000);
		});

		function refresh_data() {
			get_current_status();
			set_status("status_top", status_content["status_top"]);
			set_status("status_bottom", status_content["status_bottom"]);
		}		

	</script>
</body>
</html>
